{{- define "main" -}}

{{ $MAX_ENTRIES_RENDERED := 600 }}

{{ $entries := where .Site.RegularPages "Section" "entries" }}

{{ if eq .Kind "home" }}
  <h1>{{ .Title }}</h1>

  <div class="row">
    <div class="col-12 col-lg-8">
      <div class="list-group">
        {{ range (.Paginate (first $MAX_ENTRIES_RENDERED $entries )).Pages }}
          {{ partial "list-item-entry.html" . }}
        {{ end }}
      </div>

      <div class="position-relative my-3">
        <nav class="position-absolute start-50 translate-middle-x">
          {{ template "_internal/pagination.html" . }}
        </nav>
      </div>

    </div>
    <div class="col-12 col-lg-4">
      <a href="{{ "labels" | absURL }}" class="text-reset text-decoration-none"><b>Labels</b></a>
      <div class="justify-content-start d-flex flex-wrap">
        {{- range $.Site.Taxonomies.labels.ByCount -}}
          <a href="{{ .Page.RelPermalink }}" class="m-1 text-decoration-none text-reset btn btn-outline-secondary rounded-5">
            {{ .Term }}
          </a>
        {{ end }}
      </div>
      <hr>
      <a href="{{ "contributors" | absURL }}" class="text-reset text-decoration-none"><b>Contributors</b></a>
      <div class="justify-content-start d-flex flex-wrap">
        {{- range first 31 $.Site.Taxonomies.contributor.ByCount -}}
          <a href="{{ .Page.RelPermalink }}" class="m-1 text-decoration-none text-reset">
            <img src="{{ (index .Page.Data.category 0).Params.user.avatar_url }}" style="max-width: 32px" class="img-fluid rounded-5" alt="{{ .Page.Title }} profile picture">
          </a>
        {{ end }}
        <a href="{{ "contributors" | absURL }}" class="btn btn-outline-secondary rounded-5">…</a>
      </div>
    </div>
  </div>


{{ else if eq .Kind "taxonomy" }}

  <h1>{{ .Title }}</h1>

  <div class="container">
    {{ if eq .Section "contributor" }}
      <div class="row row-cols-1 row-cols-sm-2 row-cols-lg-3">
        {{- range $.Site.Taxonomies.contributor.ByCount -}}


          {{ if gt .Count 2 }}

          <div class="col my-2">
            <a href="{{ .Page.RelPermalink }}" class="text-decoration-none text-reset">
              <div class="card">
                <div class="row g-0">
                  <div class="col-md-3">
                    <img src="{{ (index .Page.Data.category 0).Params.user.avatar_url }}" height=32 class="img-fluid rounded-start" alt="{{ .Page.Title }} profile picture">
                  </div>
                  <div class="col-md-9">
                    <div class="card-body">
                      <h5 class="card-title">
                        {{ .Page.Title }}
                      </h5>
                          {{ $pulls := where .Page.Data.category ".Params.is_pr" true }}
                          {{ $issues := where .Page.Data.category ".Params.is_pr" false }}
                          {{ $open := where .Page.Data.category ".Params.state" "open" }}
                          {{ $closed := where .Page.Data.category ".Params.state" "closed" }}

                          {{ $open_issues := intersect $issues $open | len }}
                          {{ $closed_issues := intersect $issues $closed | len }}
                          {{ $open_pulls := intersect $pulls $open | len }}
                          {{ $closed_pulls := intersect $pulls $closed | len }}
                          <span>
                            {{ $open_pulls }} open pulls
                            {{ if ne $closed_pulls 0 }} ({{ $closed_pulls }} closed) {{ end }}
                          </span>
                          <br>
                          <span>
                            {{ $open_issues }} open issues
                            {{ if ne $closed_issues 0 }} ({{ $closed_issues }} closed) {{ end }}
                          </span>
                    </div>
                  </div>
                </div>
              </div>
            </a>
          </div>
        {{ end }}
        {{ end }}
      </div>
    {{ else if eq .Section "labels" }}
      <div class="row row-cols-3">
        {{- range $.Site.Taxonomies.labels.ByCount -}}
          <div class="col my-2">
            <a href="{{ .Page.RelPermalink }}" class="text-decoration-none text-reset">
              <div class="card">
                <div class="card-body d-flex justify-content-between align-items-center">
                  {{ .Page.Title }}
                  <span class="badge text-bg-primary">{{ .Count }}</span>
                </div>
              </div>
            </a>
          </div>
        {{ end }}
      </div>
  {{ else if eq .Section "milestone" }}
      <div class="row row-cols-3">
        {{- range $.Site.Taxonomies.milestone -}}
          <div class="col my-2">
            <a href="{{ .Page.RelPermalink }}" class="text-decoration-none text-reset">
              <div class="card">
                <div class="card-body d-flex justify-content-between align-items-center">
                  {{ .Page.Title }}
                  <span class="badge text-bg-primary">{{ .Count }}</span>
                </div>
              </div>
            </a>
          </div>
        {{ end }}
      </div>
  {{ else }}
    not implemented
  {{ end }}

  </div>

{{ else if eq .Kind "term" }}

  {{ if eq .Section "contributor" }}
    <p>
      <img src="{{ (index .Page.Data.category 0).Params.user.avatar_url }}" width=96 class="img-fluid rounded-5 mx-3" alt="{{ .Page.Title }} profile picture">
      <span class="h2">{{ .Title }}</span>
      <a href="https://github.com/{{ .Title }}" class="text-decoration-none fs-4">⮵</a>
    </p>

    {{ $pulls := where .Page.Data.category ".Params.is_pr" true }}
    {{ $issues := where .Page.Data.category ".Params.is_pr" false }}
    {{ $open := where .Page.Data.category ".Params.state" "open" }}
    {{ $closed := where .Page.Data.category ".Params.state" "closed" }}

    {{ $open_issues := intersect $issues $open }}
    {{ $closed_issues := intersect $issues $closed }}
    {{ $open_pulls := intersect $pulls $open }}
    {{ $closed_pulls := intersect $pulls $closed  }}


    <div class="container">
      <div class="row">
        <div class="col-12 col-md-6">
          <div class="list-group my-3">
            <span class="list-group-item " aria-disabled="true">
              Open Pull-Requests
            </span>
            {{ if eq 0 ($open_pulls | len)}}
              <span class="list-group-item text-center" aria-disabled="true">
                ---
              </span>
            {{ end }}
            {{ range $open_pulls }}
              {{ partial "list-item-entry.html" . }}
            {{ end }}
          </div>
          <div class="list-group my-3">
            <span class="list-group-item" aria-disabled="true">
              Closed Pull-Requests
            </span>
            {{ if eq 0 ($closed_pulls | len)}}
              <span class="list-group-item text-center" aria-disabled="true">
                ---
              </span>
            {{ end }}
            {{ range $closed_pulls }}
              {{ partial "list-item-entry.html" . }}
            {{ end }}
          </div>
        </div>
        <div class="col-12 col-md-6">
          <div class="list-group my-3">
            <span class="list-group-item" aria-disabled="true">
              Open Issues
            </span>
            {{ if eq 0 ($open_issues | len)}}
              <span class="list-group-item text-center" aria-disabled="true">---</span>
            {{ end }}
            {{ range $open_issues }}
              {{ partial "list-item-entry.html" . }}
            {{ end }}
          </div>
          <div class="list-group my-3">
            <span class="list-group-item" aria-disabled="true">
              Closed Issues
            </span>
            {{ if eq 0 ($closed_issues | len)}}
              <span class="list-group-item text-center" aria-disabled="true">---</span>
            {{ end }}
            {{ range $closed_issues }}
              {{ partial "list-item-entry.html" . }}
            {{ end }}
          </div>
        </div>
      </div>
    </div>

    <div class="container">
      <div class="row">
        <div class="col-12 col-sm-6">
        </div>
        <div class="col-12 col-sm-6">
        </div>
      </div>
    </div>

  {{ else if eq .Section "labels" }}
    <h2>
      Labeled <span class="border rounded-5 px-3">{{ .Title }}</span>
    </h2>
    <div class="list-group list-group-flush">
      {{ range .Paginator.Pages }}
        {{ partial "list-item-entry.html" . }}
      {{ end }}
    </div>
  {{ else if eq .Section "milestone" }}
    <h2>
      Milestone <span>{{ .Title }}</span>
    </h2>
    <div class="list-group list-group-flush">
      {{ range .Paginator.Pages }}
        {{ partial "list-item-entry.html" . }}
      {{ end }}
    </div>
  {{ else }}
    Unhandled Section
  {{ end }}


{{ else if eq .Kind "section" }}

  {{ $filter_pulls := where .Site.RegularPages ".Params.is_pr" true }}
  {{ $filter_issues := where .Site.RegularPages ".Params.is_pr" false }}

  {{ if eq .Section "issues" }}
    {{ $entries = intersect $entries $filter_issues }}
  {{ else if eq .Section "pulls" }}
    {{ $entries = intersect $entries $filter_pulls }}
  {{ end }}

  {{ $entries = first $MAX_ENTRIES_RENDERED $entries }}

  <h1>{{ .Title }}</h1>
  <div class="list-group list-group-flush">
    {{ range (.Paginate ( $entries )).Pages }}
      {{ partial "list-item-entry.html" . }}
    {{ end }}
  </div>

{{ else }}

  UNHANDLED KIND {{ .Kind }}

{{ end }}


{{- end -}}
